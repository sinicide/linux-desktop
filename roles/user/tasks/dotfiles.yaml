---
- name: Check for dotfiles directory
  stat:
    path: "/home/{{ username }}/.dotfiles"
  register: dotfiles_check

- name: Git clone .dotfiles
  git:
    dest: "/home/{{ username }}/.dotfiles"
    repo: "{{ dotfiles_repo }}"
  when: (dotfiles_check.stat.isdir is false) or (dotfiles_check.stat.exists is false)

- name: Install dotfiles
  shell: 'cd /home/{{ username }} && STOW_FOLDERS="nvim,tmux,zsh,alacritty" ./.dotfiles/install'
  become: no
  args:
    executable: "/bin/bash"

- name: Check for oh-my-zsh
  stat:
    path: "/home/{{ username }}/.oh-my-zsh"
  register: ohmyzsh_check

- name: Install oh-my-zsh
  shell: 'sh -c "$(curl -fsSL {{ oh_my_zsh_url }})"'
  become: no
  args:
    executable: "/bin/bash"
  when: ohmyzsh_check.stat.exists is false
